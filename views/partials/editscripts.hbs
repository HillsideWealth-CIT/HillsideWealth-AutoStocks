<script>
    const editNote = (id) => {
        let div = document.getElementById(`note${id}`)
        let parent = div.parentNode
        parent.innerHTML = `<input id="noteInput${id}" value="${div.innerHTML}" maxlength="250" /">`
        inputDiv = document.getElementById(`noteInput${id}`)
        inputDiv.addEventListener("keydown", (e) => {
            if (e.keyCode == 13) {
                fetch('/editNote', {
                    method: 'post',
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({note: inputDiv.value, stock_id: id})
                }).then(() => {parent.innerHTML = `<div id="note${id}">${inputDiv.value}</div><button type="button" onclick='editNote(${id})' class="btn btn-link btn-sm"><span class="far fa-edit"></span></button>`})
            }
        })
    }
    
    const editMoat = (id) => {
        let div = document.getElementById(`moat${id}`);
        let parent = div.parentNode;
        swal.fire({
            title: "Select Moat",
            input: "select",
            inputOptions: {
                'No Moat': 'No Moat',
                'Wide': 'Wide',
                'Narrow': 'Narrow',
            },
            inputPlaceholder: 'Select a moat',
            showCancelButton: true,
            preConfirm: (inputText) => {
                ajax_edit("moat", id, inputText)
                .then((resolved) => {
                    return resolved
                })
            }
        }).then((result) => {
            if(!result.dismiss){
                parent.innerHTML = `<div id="moat${id}">${result.value}</div><button type="button" onclick='editMoat(${id})' class="btn btn-link btn-sm"><span class="far fa-edit"></span></button>`
            }
        })
    }

    const editEmoticon = (id) => {
        let div = document.getElementById(`emoticon${id}`);
        let parent = div.parentNode;
        swal.fire({
            title: "Select Emote",
            input: "select",
            inputOptions: {
                'ðŸ˜ƒ': 'ðŸ˜ƒ',
                'ðŸ¤‘':'ðŸ¤‘',
                'ðŸ˜«':'ðŸ˜«',
                'ðŸ’©': 'ðŸ’©',
            },
            inputPlaceholder: 'Select an emote',
            showCancelButton: true,
            preConfirm: (inputText) => {
                ajax_edit("emote", id, inputText)
                .then((resolved) => {
                    return resolved
                })
            }
        }).then((result) => {
            if(!result.dismiss){
                parent.innerHTML = `<div style="font-size: 30px" id="emoticon${id}">${result.value}</div><button type="button" onclick='editEmoticon(${id})' class="btn btn-link btn-sm"><span class="far fa-edit"></span></button>`
            }
        })
    }

    const editPrice = (id, action) => {
        let div = document.getElementById(`${action}${id}`);
        let parent = div.parentNode;
        //parent.innerHTML=`<input id="priceInput${id}" value="${div.innerHTML}" maxlength="250/">`
        swal.fire({
            title: "Edit The Price",
            input: 'text',
            showConfirmButton: true,
            showCancelButton: true,
            preConfirm: (inputText) => {
                ajax_edit(action, id, inputText).then((resolved) => {
                    return resolved
                })
            }
        }).then((result) => {
            if(!result.dismiss){
                if(Number.isNaN(parseFloat(result.value)) === false && action != 'jdv') {
                    parent.innerHTML = `<div id="${action}${id}">$${result.value}</div><button type="button" onclick='editPrice(${id}, ${action})' class="btn btn-link btn-sm"><span class="far fa-edit"></span></button>`
                }
                if(Number.isNaN(parseFloat(result.value)) === false && action == 'jdv') {
                    parent.innerHTML = `<div id="${action}${id}">${result.value}</div><button type="button" onclick='editPrice(${id}, ${action})' class="btn btn-link btn-sm"><span class="far fa-edit"></span></button>`
                }
                if(Number.isNaN(parseFloat(result.value)) === true) {
                    Swal.fire({
                        title: "INVALID INPUT",
                        text: 'Please enter in a valid number',
                        type: 'error',
                    })
                }
            }
        })
    }

    function ajax_edit(action, id, userInput){
        return new Promise ((resolve, reject) => {
            var data = {};
            data.action = action;
            data.edit = userInput;
            data.id = id;
            $.ajax({
                type: "POST",
                data: JSON.stringify(data),
                contentType: 'application/json',
                url: "/edit",
            }).done(function(returned_data){
                resolve(returned_data);
            })
        })
    }
</script>