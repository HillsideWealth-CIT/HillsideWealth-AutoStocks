<!DOCTYPE html>
<html>

<head>
    <title>Collection</title>
    <meta charset="utf-8">
    <style>
        .fixed-table-container {
            background-color: white
        }

        th:nth-child(3),
        td:nth-child(3) {
            position: sticky;
            left: 0px;
        }

        td:nth-child(3) {
            background-color: #F0F0F0;
            z-index: 999;
        }
    </style>
</head>

<body>
    {{>header}}
    <div class="container-fluid">
        <div class="d-flex justify-content-center">
            <div class="table-responsive p-3">
                <table id="table" data-toggle="table" data-search="true" data-toolbar="#toolbar" data-height="800"
                    data-show-columns="true" class="table table1 table-hover">
                    <thead class='thead-dark'>
                        <tr>
                            <th data-sortable="true">Code</th>
                            <th data-sortable="true">Type</th>
                            <th data-sortable="true">Task</th>

                        </tr>
                    </thead>
                    <tbody>
                        {{#each codes}}
                        <tr>
                            {{#if this.code}}
                            <td id="{{this.code_id}}code"><div style="background-color:black; color:black" onclick="unhide(this)">{{this.code}}</div></td>
                            {{else}}
                            <td>Null</td>
                            {{/if}}
                            {{#if this.type}}
                            <td id="{{this.code_id}}type">{{this.type}}</td>
                            {{else}}
                            <td>Null</td>
                            {{/if}}
                            <td><input id="{{this.code_id}}text" type="text" maxlength="30" placeholder=" Enter a new code"/><button onclick="changeCode({{this.code_id}}, document.getElementById('{{this.code_id}}text').value)">Change Code</button> <button onclick="changeCode({{this.code_id}}, randomString(10))">Randomize Code</button>
                            </td>
                        </tr>
                        {{/each}}
                    </tbody>
                </table>
            </div>
        </div>


</body>
<script>
    const randomString = (length) => {
        var chars = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'
        var result = '';
        for (var i = length; i > 0; --i) result += chars[Math.floor(Math.random() * chars.length)];
        return result;
    }

    const unhide = (self) => {
        self.style.backgroundColor = ''
    }


    const changeCode = (code_id, newCode) => {
        const data = {
            code_id: code_id,
            newCode: newCode
        }
        console.log(data)
        fetch(`/newCode`, {
            method: 'post',
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data)
        })
            .then((r) => r.json())
            .then(r => {
                document.getElementById(`${r.code_id}code`).innerHTML= r.newCode
            })
    }
</script>


</html>
